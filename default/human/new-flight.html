<!DOCTYPE html>
<!--
  ~ Copyright (c) Erik Partridge 2015. All rights reserved, program is for TakeoffSim.com
  -->

<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Creating a New Flight</title>
    <link href="../resources/css/bootstrap.min.css" rel="stylesheet">
    <script type="text/javascript" src="../resources/js/jquery.min.js"></script>
    <script type="text/javascript" src="../resources/js/bootstrap.min.js"></script>
    <script src="../resources/js/Chart.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="../resources/js/chosen/chosen.jquery.min.js"></script>
    <link href="../resources/js/chosen/chosen.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <h1 style="margin-left: auto; margin-right:auto;">Creating a new route</h1>
        <div class="row">
            <div class="col-md-6">
                <p>Depart:</p>
                <select id="depart">
                    {% for apt in airports %}
                        <option value="{{apt.icao}}">{{apt.icao}} - {{apt.name}}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-6">
                <p>Arrive:</p>
                <select id="arrive">
                    {% for apt in airports %}
                        <option value="{{apt.icao}}">{{apt.icao}} - {{apt.name}}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col-md-5"></div>
            <div class="col-md-2">
                <button id="researchGo">Research Route!</button>
            </div>
            <div class="col-md-5"></div>
        </div>
        <hr>
    </div>
    <div class="container" id="results">
        <div class="row" id="loading">
            <div class="col-md-5">
            </div>
            <div class="col-md-2">
                <p>Researching... Stand by</p>
            </div>
            <div class="col-md-5"></div>
        </div>
        <div class="col-md-8" id="res">
            <canvas id="chart" width="500" height="250px"></canvas>
        </div>

    </div>
    <script>
        $( document ).ready(function(){
        $('#loading').hide();
        $('#res').hide();
        var ctx = document.getElementById("chart").getContext("2d");

        $('#depart').chosen({no_results_text: 'Oops, no airport found!'});
        $('#arrive').chosen({no_results_text: 'Oops, no airport found!'});
        $("#researchGo").click(function(){
            $('#loading').show();
            $.ajax({
                url: '/ajax/researchRoute.json',
                data: "depart=" + $('#depart').val() + "&arrive=" + $("#arrive").val(),
                datatype: 'json',
                success : function(data){
                    var projected = data[0];
                    var onroute = data[1];
                    var d = {
                        labels: ["Daily O & D", "Current Seats"],
                        datasets: [
                            {
                                label:"Your Researcher",
                                fillColor: "rgba(151,187,205,0.5)",
                                strokeColor: "rgba(151,187,205,0.8)",
                                highlightFill: "rgba(151,187,205,0.75)",
                                highlightStroke: "rgba(151,187,205,1)",
                                data: [projected, onroute]
                            }
                        ]
                    }
                    var chart = new Chart(ctx).Bar(d);
                    $("#res").show();
                    $("#loading").hide();
                }
            });

        });
        });
    </script>
</body>
</html>